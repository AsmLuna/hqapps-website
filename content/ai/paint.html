---
title: "Image Generator"
date: 2024-05-07T21:11:22+02:00
draft: false
---

<div class="hqaitoolbar">
    <span><b>HQ AI</b></span>
    <span>*</span>
    <li class="aiappstabs">
        <ul><a href="../chat">Chad</a></ul>
        <ul class="active"><a href="../paint">Paint</a></ul>
    </li>
</div>

<div class="chat paint">
    <form class="idk">
        <div>
            <input type="text" placeholder="Imagin......." class="promptinput">
            <input type="submit" value="Generate" class="sned">
            <textarea class="extra-options" style="display: none;"></textarea>
        </div>
    </form>

    <div class="image-gallery">
        <div class="chat-info">
            <h2>Beginn to make the image!!</h2>
        </div>
    </div>
</div>

<script>

    let session = "";

    const baseURL = "https://hqapps.org/api/llm"

    const form = document.querySelector(".idk")
    const imggallery = document.querySelector(".image-gallery")
    const extraOptions = document.querySelector(".extra-options")

    function saveSession() {
        localStorage.setItem("session", session)
    }

    function loadSession() {
        session = localStorage.getItem("session") || ""
    }

    async function doImgAI(prompt) {

        /*if (!session || session.split("_")[0] <= Date.now()) {
            await getSession()
            console.log("captcha done")
        }*/

        const requestBody = {
            "product": "hqaipaint",
            "prompt": prompt,
            "session": session
        }

        if(extraOptions.value != "") requestBody["extra"] = JSON.parse(extraOptions.value)

        const response = await fetch(baseURL, {
            "headers": {
                "x-hq-api-key": "uwu69owo:3",
            },
            "body": JSON.stringify(requestBody),
            "method": "POST",
        });

        const blob = await response.blob()

        return blob
    }

    async function generateImg(e) {

        imggallery.innerHTML = `
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
        `
        e.preventDefault()
        const prompt = form.querySelector(".promptinput").value
        const imgblob = await doImgAI(prompt)

        imggallery.innerHTML = `
            <img src="${URL.createObjectURL(imgblob)}">
            <div>
                <button onclick="clearimg()">my eyes hurt</button>
                <a href="${URL.createObjectURL(imgblob)}" download><button>save image</button></a>
            </div>
        `
    }

    function clearimg() {
        imggallery.innerHTML = `<div class="chat-info">
            <h2>Beginn to make the image!!</h2>
        </div>`
    }

    function doCaptcha() {
        return new Promise((resolve) => {
            //noloadmesage()
            imggallery.innerHTML = `<div id="turnstile-container"></div>`
            turnstile.render('#turnstile-container', {
                sitekey: '0x4AAAAAAAaUKiQooN03nv_e',
                callback: function (token) {
                    resolve(token)
                },
            });
        })
    }

    async function getSession() {
        const captchaToken = await doCaptcha()
        imggallery.innerHTML = `
                <div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>
        `
        const response = await fetch(`${baseURL}/registersession?turnstile=${encodeURI(captchaToken)}`)
        const token = await response.text()
        console.log(token)
        session = token
        saveSession()
    }

    function showExtra() {
        extraOptions.style.display = "block"
    }

    loadSession()

    form.addEventListener("submit", generateImg)
</script>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=onloadTurnstilerReadyCallback"></script>